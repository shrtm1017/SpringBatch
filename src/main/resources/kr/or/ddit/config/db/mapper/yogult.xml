<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="yogult">
	<!-- 일실적 일괄삭제 -->
	<delete id="deleteDailtyYm" parameterType="string">
		delete daily where dt like #{ym} || '%'
	<!-- 일실적 생성 -->	
	</delete>
	<insert id="dailyBatchYm" parameterType="string">
	insert into daily
      select cycle.cid,cycle.pid,cal.dt,cycle.cnt
      from cycle ,         
              (select to_char(to_date(#{ym} || '01','yyyyMMdd') + (level-1),'d') day,-- 해당 년월의 요일(숫자), 일자(yyyyMMdd)
                      to_char(to_date(#{ym} || '01','yyyyMMdd') + (level-1),'yyyyMMdd') dt
              from dual
              connect by level &lt;= last_day(to_date(#{ym},'yyyyMM'))
                      -to_date(#{ym} || '01', 'yyyyMMdd')+1) cal
      where cycle.day = cal.day
	</insert>
	
</mapper>